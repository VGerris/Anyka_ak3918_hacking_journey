#! /bin/sh
check_exploit()
{
  myresult=$( grep gergehack.sh /etc/jffs2/time_zone.sh )
  if [[ "$myresult" != '/etc/jffs2/gergehack.sh' ]]; then
    fix_exploit
  fi
}

fix_exploit()
{
  echo -e '  _________________________________\n |                                 |\n |           exploit fix           |\n |_________________________________|'
  #timezoneline=$( cat /etc/jffs2/time_zone.sh )
  echo 'telnetd &' > /etc/jffs2/time_zone.sh #this line is needed on stock system
  echo '/etc/jffs2/gergehack.sh' >> /etc/jffs2/time_zone.sh
  #echo $timezoneline >> /etc/jffs2/time_zone.sh
  echo 'export TZ=GMT-02:00' >> /etc/jffs2/time_zone.sh
}

while [ 1 ]; do
  check_exploit
  sleep 5
done
