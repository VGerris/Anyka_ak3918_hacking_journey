#! /bin/sh

# check duplicate process
if [[ -f /tmp/exploit.txt ]]; then
  echo 'gergedaemon is already running'
  # exit if there is already an instance of this script running
  if [[ -f /tmp/exploit1.txt ]]; then
    echo 'anyka_ipc terminated'
  else
    echo "exploit">/tmp/exploit1.txt
    #https://github.com/burlizzi/anyka/blob/master/source/daemon/src/daemon.c (line 1935)
    killall -SIGUSR2 daemon #close watchdog so that anyka_ipc is not restarted
    killall anyka_ipc.sh # this time it will not be restarted
    sleep 5
    killall -SIGTERM daemon
  fi
else
  echo "exploit">/tmp/exploit.txt
  busybox telnetd &
  echo -e "  _________________________________\n |                                 |\n |       Gerge Hacked This         |\n |_________________________________|"
  /etc/jffs2/gergedaemon.sh &
  echo '*************  start network service   *************'
  /usr/sbin/wifi_manage.sh start
  echo '*************     serve snapshots      *************'
  /mnt/anyka_hack/snapshot_daemon.sh &
fi
